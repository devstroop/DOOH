@using DOOH.Server.Models.DOOHDB
@layout AdminLayout
@page "/admin/campaigns/editor/{CampaignId}"
@page "/admin/campaigns/editor"
@attribute [Authorize]
<PageTitle>Campaign Editor</PageTitle>
<RadzenStack>
    <RadzenRow class="rz-mb-2" AlignItems="AlignItems.Center" Gap="1rem" RowGap="1rem">
        <RadzenColumn SizeMD="6">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Start" AlignItems="AlignItems.Center" Gap="1rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenIcon Icon="campaign" Style="font-size: 28px" />
                    <RadzenText Text="@CampaignName" TextStyle="TextStyle.H5" style="margin: 0" Visible="!CampaignNameEditable" />
                    <RadzenTextBox style="appearance: none; font-weight: 500; border: none; text-align: start; font-size: 16px; padding-inline: 6px" @bind-Value="@CampaignName" Name="CampaignName" Visible="@CampaignNameEditable" />
                    <RadzenButton class="rz-ml-2" Icon="edit" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" Visible="!CampaignNameEditable" Click="@((args) => CampaignNameEditable=true)" />
                    <RadzenButton class="rz-ml-2" Icon="check" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Small" Visible="@CampaignNameEditable" Click="@((args) => CampaignNameEditable=false)" />
                </RadzenStack>
            </RadzenStack>
        </RadzenColumn>
        <RadzenColumn SizeMD="6">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" AlignItems="AlignItems.Center" Gap="0.5rem">
                <RadzenButton Icon="save" Text="Save" ButtonStyle="ButtonStyle.Primary" Click="@SaveCampaign" IsBusy="@IsSaving" BusyText="Saving" />
                <RadzenButton Icon="cancel" Text="Cancel" ButtonStyle="ButtonStyle.Secondary" Click="@Cancel" />
            </RadzenStack>
        </RadzenColumn>
    </RadzenRow>
    <RadzenRow JustifyContent="JustifyContent.Stretch">
        <RadzenFieldset Text="Date">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                <RadzenDatePicker @bind-Value="@StartDate" DateFormat="d" Style="width: 150px" />
                <RadzenText Text="to" class="rz-mb-0" />
                <RadzenDatePicker @bind-Value="@EndDate" DateFormat="d" Style="width: 150px" Visible="!Continuous" />
                <RadzenCheckBox Placeholder="Continuous" @bind-Value="@Continuous" />
                <RadzenText Text="Continuous" class="rz-mb-0" Style="font-size: 14px; font-weight: 500;" />
            </RadzenStack>
        </RadzenFieldset>
        <RadzenFieldset Text="Budget">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem">
                <RadzenSelectBar TValue="BudgetType" Size="ButtonSize.Small" @bind-Value="@BudgetType">
                    <Items>
                        @foreach(var each in Enum.GetValues(typeof(BudgetType)).Cast<BudgetType>())
                        {
                            <RadzenSelectBarItem Value="@each" Text="@each.ToString()" />
                        }
                    </Items>
                </RadzenSelectBar>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenButton Icon="remove" Size="ButtonSize.Small" Click="@((args) => Budget -= 100)" />
                    <RadzenNumeric class="budget-input" @bind-Value="@Budget" Name="Budget" Min="0" Max="10000" Style="text-align: center; width: 84px; max-width: 120px; appearance: none; border: none; font-size: 14px; font-weight: bold;" />
                    <RadzenButton Icon="add" Size="ButtonSize.Small" Click="@((args) => Budget += 100)" />
                </RadzenStack>
            </RadzenStack>
        </RadzenFieldset>
        <RadzenFieldset Text="Status">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                <RadzenDropDown TValue="int" @bind-Value="@StatusId" ValueProperty="StatusId" TextProperty="StatusName" Data="@statuses" LoadData="@statusesLoadData" Count="@statusesCount">
                    <Template>
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                            <RadzenIcon Icon="fiber_manual_record" IconColor="@context.StatusColor" ></RadzenIcon>
                            <RadzenText Text="@context.StatusName" class="rz-mb-0" TextStyle="TextStyle.Body2"></RadzenText>
                        </RadzenStack>
                    </Template>
                </RadzenDropDown>
            </RadzenStack>
        </RadzenFieldset>
    </RadzenRow>
    <RadzenTabs @bind-SelectedIndex="@selectedTabIndex">
        <Tabs>
            <RadzenTabsItem Text="Locations" Icon="location_on">
                <CampaignAdboardsEditor CampaignId="@CampaignIdInt" SelectedAdboardIds="selectedAdboardIds" Add="@OnAddAdboard" Remove="@OnRemoveAdboard" Clear="@OnClearAdboards"/>
            </RadzenTabsItem>
            <RadzenTabsItem Text="Advertisements" Icon="featured_video">
                <CampaignAdvertisementsEditor CampaignId="@CampaignIdInt" Refresh="@OnRefresh" />
            </RadzenTabsItem>
            <RadzenTabsItem Text="Schedule" Icon="schedule">
                <CampaignScheduleEditor CampaignId="@CampaignIdInt" />
            </RadzenTabsItem>
            <RadzenTabsItem Text="Review" Icon="grading">
                <Review CampaignId="@CampaignIdInt" />
            </RadzenTabsItem>
        </Tabs>
    </RadzenTabs>
</RadzenStack>

<style>
    .rz-dialog-titlebar {
        background-color: #fff;
    }

    .rz-dialog-content {
        background-color: #fff;
    }

    .rz-spinner-button {
        display: none;
    }
    .budget-input input{
        border: none;
        text-align: center;
        font-size: 14px;
        font-weight: bold;
    }
    .budget-input .rz-spinner input[type=number], .rz-spinner input[type=text] {
        padding: 0;
    }
</style>

