@using DOOH.Server.Models.DOOHDB
@using DOOH.Server.Models.Enums
@layout AdminLayout
@page "/admin/campaigns/editor/{CampaignId}"
@page "/admin/campaigns/editor"
@attribute [Authorize]

<PageTitle>Campaign Editor</PageTitle>
<RadzenStack>
    <RadzenRow class="rz-mb-2" AlignItems="AlignItems.Center" Gap="1rem" RowGap="1rem">
        <RadzenColumn SizeMD="6">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Start" AlignItems="AlignItems.Center" Gap="1rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenIcon Icon="campaign" Style="font-size: 28px" />
                    <RadzenText Text="@($"{(_campaignId != 0 ? CampaignId.ToString() : "New")}")" class="rz-mb-0 rz-px-2 rz-py-1" Style="font-size: 12px; font-weight: 600; background-color: #dfdfdf; border-radius: 6px" />
                    <RadzenText Text="@CampaignName" TextStyle="TextStyle.H5" style="margin: 0" Visible="!CampaignNameEditable" />
                    <RadzenTextBox style="appearance: none; font-weight: 500; border: none; text-align: start; font-size: 16px; padding-inline: 6px" @bind-Value="@CampaignName" Name="CampaignName" Visible="@CampaignNameEditable" />
                    <RadzenButton class="rz-ml-2" Icon="edit" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" Visible="!CampaignNameEditable" Click="@((args) => CampaignNameEditable=true)" />
                    <RadzenButton class="rz-ml-2" Icon="check" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Small" Visible="@CampaignNameEditable" Click="@((args) => CampaignNameEditable=false)" />
                </RadzenStack>
            </RadzenStack>
        </RadzenColumn>
        <RadzenColumn SizeMD="6">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" AlignItems="AlignItems.Center" Gap="0.5rem">
                <RadzenButton Icon="save" Text="Save" ButtonStyle="Radzen.ButtonStyle.Primary" Click="@SaveCampaign" IsBusy="@IsSaving" BusyText="Saving" />
                <RadzenButton Icon="cancel" Text="Cancel" ButtonStyle="ButtonStyle.Secondary" Click="@Cancel" />
            </RadzenStack>
        </RadzenColumn>
    </RadzenRow>
    <RadzenRow JustifyContent="JustifyContent.Stretch">
        <RadzenCard>
            <DateRangeComponent Start="@StartDate" End="@EndDate"></DateRangeComponent>
        </RadzenCard>
        <RadzenCard>
            <RadzenStack Gap="0.5rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                    <RadzenIcon Icon="currency_rupee"></RadzenIcon>
                    <RadzenText Text="Budget" TextStyle="TextStyle.Body1" Style="font-weight: 500;"></RadzenText>
                </RadzenStack>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem">
                    <RadzenSelectBar TValue="BudgetType" Size="ButtonSize.Small" @bind-Value="@BudgetType">
                        <Items>
                            @foreach(var each in Enum.GetValues(typeof(BudgetType)).Cast<BudgetType>())
                            {
                                <RadzenSelectBarItem Value="@each" Text="@each.ToString()" />
                            }
                        </Items>
                    </RadzenSelectBar>
                    <NumericRangeComponent @bind-Value="@Budget" ChangeValue="100" Min="0" Max="10000"></NumericRangeComponent>
                    @* <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem"> *@
                    @*     <RadzenButton Icon="remove" Size="ButtonSize.Small" Click="@((args) => Budget -= 100)" /> *@
                    @*     <RadzenNumeric class="budget-input" @bind-Value="@Budget" Name="Budget" Min="0" Max="10000" Style="text-align: center; width: 84px; max-width: 120px; appearance: none; border: none; font-size: 14px; font-weight: bold;" /> *@
                    @*     <RadzenButton Icon="add" Size="ButtonSize.Small" Click="@((args) => Budget += 100)" /> *@
                    @* </RadzenStack> *@
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>
        <RadzenCard>
            <RadzenStack Gap="0.5rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                    <RadzenIcon Icon="done_all"></RadzenIcon>
                    <RadzenText Text="Status" TextStyle="TextStyle.Body1" Style="font-weight: 500;"></RadzenText>
                </RadzenStack>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenDropDown TValue="DOOH.Server.Models.Enums.Status" @bind-Value="@Status" Data="@(Enum.GetValues(typeof(DOOH.Server.Models.Enums.Status)).Cast<DOOH.Server.Models.Enums.Status>())">
                        <Template>
                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                <RadzenIcon Icon="@DOOH.Server.Extensions.StatusExtensions.GetIcon((DOOH.Server.Models.Enums.Status)context)" IconColor="@DOOH.Server.Extensions.StatusExtensions.GetColor((DOOH.Server.Models.Enums.Status)context)" ></RadzenIcon>
                                <RadzenText Text="@DOOH.Server.Extensions.StatusExtensions.ToFriendlyString((DOOH.Server.Models.Enums.Status)context)" class="rz-mb-0" TextStyle="TextStyle.Body2"></RadzenText>
                            </RadzenStack>
                        </Template>
                    </RadzenDropDown>
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>
    </RadzenRow>
    <RadzenCard>
        <RadzenTabs @bind-SelectedIndex="@_selectedTabIndex">
            <Tabs>
                <RadzenTabsItem Text="Locations" Icon="location_on">
                    <CampaignAdboardsEditor CampaignId="@_campaignId" Data="@_selectedAdboards" Add="@OnAddAdboard" Remove="@OnRemoveAdboard" Clear="@OnClearAdboards"/>
                </RadzenTabsItem>
                <RadzenTabsItem Text="Advertisements" Icon="featured_video">
                    <CampaignAdvertisementsEditor CampaignId="@_campaignId" Data="@_advertisements" Add="@OnAddAdvertisement" Delete="@OnDeleteAdvertisement" Refresh="@OnRefresh" />
                </RadzenTabsItem>
                <RadzenTabsItem Text="Schedule" Icon="schedule">
                    <ScheduleEditor CampaignId="@_campaignId" Data="@_schedules" SelectedAdboards="@_selectedAdboards" Add="@AddSchedule" Update="@UpdateSchedule" Delete="@DeleteSchedule" />
                </RadzenTabsItem>
                @* <RadzenTabsItem Text="Review" Icon="grading"> *@
                @*     <Review CampaignId="@CampaignIdInt" /> *@
                @* </RadzenTabsItem> *@
            </Tabs>
        </RadzenTabs>
    </RadzenCard>
</RadzenStack>

<style>
    .rz-tabview-nav {
        width: auto;
        overflow-x: auto; 
        scroll-margin-left: 1rem;
    }
    .rz-dialog-titlebar {
        background-color: #fff;
    }

    .rz-dialog-content {
        background-color: #fff;
    }

    .rz-spinner-button {
        display: none;
    }
</style>

