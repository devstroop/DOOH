@using DOOH.Server.Models.DOOHDB
@inject DialogService DialogService

<RadzenTemplateForm TItem="DOOH.Server.Models.DOOHDB.Schedule" Data="@Schedule" Submit=@OnSubmit Visible="@(Schedule != null)">
    <RadzenRow style="margin-bottom: 16px" AlignItems="AlignItems.Center">
        <RadzenColumn Size="6" SizeMD="3">
            <RadzenLabel Text="Date" />
        </RadzenColumn>
        <RadzenColumn Size="6" SizeMD="3">
            <RadzenDatePicker @bind-Value="@Schedule.Date" Name="Start" ShowTime="false" class="w-100" DateFormat="d" />
        </RadzenColumn>
        <RadzenColumn Size="6" SizeMD="3">
            <RadzenLabel Text="Rotation" />
        </RadzenColumn>
        <RadzenColumn Size="6" SizeMD="3">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center" class="w-100 rz-mb-1" Gap="0.5rem">
                <RadzenButton Icon="remove" Size="ButtonSize.Small" Click="@((args) => Schedule.Rotation -= 1)" />
                <RadzenNumeric class="rotation-input" @bind-Value="@Schedule.Rotation" Name="Budget" Min="0" Max="100" Style="text-align: center; width: 84px; max-width: 120px; appearance: none; border: none; font-size: 14px; font-weight: bold;" />
                <RadzenButton Icon="add" Size="ButtonSize.Small" Click="@((args) => Schedule.Rotation += 1)" />
            </RadzenStack>
        </RadzenColumn>
    </RadzenRow>
    <RadzenRow>
        <RadzenColumn SizeMD="3">
            <RadzenLabel Text="Adboards" />
        </RadzenColumn>
        <RadzenColumn SizeMD="9">
            <RadzenDropDownDataGrid @ref="grid" class="w-100" Chips="true" AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowClear="true" @bind-Value="@selectedAdboardIds"
                                    Multiple="true" Placeholder="Select..." Data=@Adboards TextProperty="@nameof(Adboard.SignName)" ValueProperty="@nameof(Adboard.AdboardId)" Name="DropDownDataGridMultiple">
                <Columns>
                    <RadzenDropDownDataGridColumn Width="36px" Sortable="false">
                        <HeaderTemplate>
                            <RadzenCheckBox InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select all" }})" Disabled="@(!grid.AllowSelectAll)" TriState="false" TValue="bool" Value="@(Adboards.Any(c => selectedAdboardIds != null && selectedAdboardIds.Contains(c.AdboardId)))"
                                            Change="@(args => selectedAdboardIds = args ? grid.View.Cast<Adboard>().Select(c => c.AdboardId).AsEnumerable() : selectedAdboardIds = Enumerable.Empty<int>())" />
                        </HeaderTemplate>
                        <Template Context="data">
                            <RadzenCheckBox InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select item" }})" TriState="false" Value="@(selectedAdboardIds != null && selectedAdboardIds.Contains(((Server.Models.DOOHDB.Adboard) data).AdboardId))"
                                            TValue="bool" Change=@(args => grid.SelectItem(data)) @onclick:stopPropagation/>
                        </Template>
                    </RadzenDropDownDataGridColumn>
                    <RadzenDropDownDataGridColumn Property="@nameof(Adboard.AdboardId)" Title="Id" Width="54px">
                        <Template Context="data">
                            <RadzenRow>
                                <RadzenText Text="@($"{data.AdboardId}")" class="rz-mb-0 rz-px-1 rz-py-05" Style="font-size: 12px; font-weight: 600; background-color: #dfdfdf; border-radius: 4px" />
                            </RadzenRow>
                        </Template>
                    </RadzenDropDownDataGridColumn>
                    <RadzenDropDownDataGridColumn Property="@nameof(Adboard.SignName)" Title="SignName" Width="100px" />
                    <RadzenDropDownDataGridColumn Property="@nameof(Adboard.BaseRatePerSecond)" Title="Rate" Width="72px">
                        <Template Context="data">
                            <RadzenText Text="@($"{data.BaseRatePerSecond:C}/s")" class="rz-mb-0" Style="font-size: 14px; font-weight: 500; color: green;"/>
                        </Template>
                    </RadzenDropDownDataGridColumn>
                </Columns>
            </RadzenDropDownDataGrid>
        </RadzenColumn>
    </RadzenRow>
    <RadzenRow class="rz-mt-4">
        <RadzenColumn Size="12">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                <RadzenButton ButtonType="ButtonType.Submit" Text="Save" />
            </RadzenStack>
        </RadzenColumn>
    </RadzenRow>
</RadzenTemplateForm>
<style>

    .rotation-input input{
        border: none;
        text-align: center;
        font-size: 14px;
        font-weight: bold;
    }
    .rotation-input .rz-spinner input[type=number], .rz-spinner input[type=text] {
        padding: 0;
    }
    /*div.rz-dialog{*/
    /*    width: 330px !important;*/
    /*}*/
</style>